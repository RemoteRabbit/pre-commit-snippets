{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"pre-commit-snippet","text":"<p>A pre-commit hook that automatically syncs markdown snippets from a central repository into your documentation files.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Marker-based replacement: Uses <code>&lt;!-- SNIPPET-START: name --&gt;</code> / <code>&lt;!-- SNIPPET-END --&gt;</code> markers to identify replaceable blocks</li> <li>SHA-256 caching: Only rewrites blocks when the central snippet has actually changed, avoiding unnecessary file churn</li> <li>Automatic staging: Modified files are automatically staged for commit</li> <li>Branch/tag support: Pin snippets to a specific branch or tag</li> <li>Dry-run mode: Preview changes without modifying files</li> <li>Debug logging: Detailed logging for troubleshooting</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>pip install pre-commit-snippet\n</code></pre> <p>Create a <code>pre-commit-snippet-config.yaml</code>:</p> <pre><code>snippet_repo: https://github.com/your-org/snippets.git\ntarget_files:\n  - README.md\n</code></pre> <p>Add markers to your markdown files:</p> <pre><code>&lt;!-- SNIPPET-START: my-snippet --&gt;\nThis will be replaced with content from my-snippet.md\n&lt;!-- SNIPPET-END --&gt;\n</code></pre> <p>Run the hook:</p> <pre><code>pre-commit-snippet\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation - Detailed installation options</li> <li>Configuration - All configuration options</li> <li>Usage - Command line options and examples</li> <li>API Reference - Module documentation</li> </ul>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#changelog_1","title":"Changelog","text":""},{"location":"changelog/#102-2026-01-15","title":"1.0.2 (2026-01-15)","text":""},{"location":"changelog/#bug-fixes","title":"Bug Fixes","text":"<ul> <li>remove python and pypi from badges (#6) (714518e)</li> </ul>"},{"location":"changelog/#101-2026-01-15","title":"1.0.1 (2026-01-15)","text":""},{"location":"changelog/#bug-fixes_1","title":"Bug Fixes","text":"<ul> <li>stop overriding default docs version on every push (b6cd249)</li> </ul>"},{"location":"changelog/#100-2026-01-15","title":"1.0.0 (2026-01-15)","text":""},{"location":"changelog/#features","title":"Features","text":"<ul> <li>initial project setup (b729e37)</li> </ul>"},{"location":"changelog/#bug-fixes_2","title":"Bug Fixes","text":"<ul> <li>ci: handle missing gh-pages branch in docs workflow (b1d2c0f)</li> <li>resolve lint and type errors (eec8769)</li> <li>update repository URLs and fix deprecated tags config (0874ec8)</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to pre-commit-snippet!</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<pre><code># Clone the repository\ngit clone https://github.com/YOUR_USERNAME/pre-commit-snippet.git\ncd pre-commit-snippet\n\n# Install dependencies and set up pre-commit hooks\nmake setup\n</code></pre>"},{"location":"contributing/#running-tests","title":"Running Tests","text":"<pre><code>make test\n</code></pre>"},{"location":"contributing/#running-all-checks","title":"Running All Checks","text":"<pre><code>make check  # lint, format, typecheck, test\n</code></pre>"},{"location":"contributing/#building-documentation","title":"Building Documentation","text":"<pre><code># Install docs dependencies\npip install mkdocs mkdocs-material mkdocstrings[python]\n\n# Serve locally\nmake docs-serve\n\n# Build static site\nmake docs-build\n</code></pre>"},{"location":"contributing/#conventional-commits","title":"Conventional Commits","text":"<p>This project uses Conventional Commits for automated versioning.</p>"},{"location":"contributing/#commit-types","title":"Commit Types","text":"Type Description Version Bump <code>feat</code> A new feature Minor <code>fix</code> A bug fix Patch <code>docs</code> Documentation only None <code>refactor</code> Code refactoring None <code>test</code> Adding tests None <code>chore</code> Maintenance None"},{"location":"contributing/#examples","title":"Examples","text":"<pre><code>feat: add support for multiple snippet repositories\nfix: handle missing SNIPPET-END marker gracefully\ndocs: update README with configuration examples\n</code></pre>"},{"location":"contributing/#release-process","title":"Release Process","text":"<p>Releases are automated using Release Please.</p> <ol> <li>Merge commits following Conventional Commits format</li> <li>Release Please creates/updates a release PR</li> <li>Merge the release PR to create a GitHub release</li> </ol>"},{"location":"tags/","title":"Tags","text":"<p>Browse documentation by topic:</p> <p>[TAGS]</p>"},{"location":"api/","title":"API Reference","text":"<p>This section documents the Python API for pre-commit-snippet.</p>"},{"location":"api/#package-structure","title":"Package Structure","text":"<pre><code>pre_commit_snippet/\n\u251c\u2500\u2500 __init__.py     # Package init, exports main()\n\u251c\u2500\u2500 cache.py        # Hash computation and caching\n\u251c\u2500\u2500 cli.py          # Command-line interface\n\u251c\u2500\u2500 config.py       # Configuration loading\n\u251c\u2500\u2500 git.py          # Git operations\n\u251c\u2500\u2500 logging.py      # Logging configuration\n\u2514\u2500\u2500 snippet.py      # Snippet replacement logic\n</code></pre>"},{"location":"api/#modules","title":"Modules","text":"Module Description cli Main entry point and argument parsing config Configuration loading and validation cache Hash computation and cache management git Git operations (clone, stage, etc.) snippet Core snippet replacement logic logging Logging configuration"},{"location":"api/#quick-example","title":"Quick Example","text":"<pre><code>from pre_commit_snippet import main\n\n# Run with default arguments\nexit_code = main()\n</code></pre>"},{"location":"api/cache/","title":"cache","text":"<p>Cache handling for snippet hashes.</p>"},{"location":"api/cache/#pre_commit_snippet.cache","title":"<code>cache</code>","text":"<p>Cache handling for snippet hashes.</p> <p>This module provides functions for computing content hashes and managing the cache file that tracks which snippets have been applied to which files. The cache prevents unnecessary file rewrites when snippets haven't changed.</p>"},{"location":"api/cache/#pre_commit_snippet.cache.compute_hash","title":"<code>compute_hash(text)</code>","text":"<p>Return a deterministic SHA-256 hex digest for a Unicode string.</p> <p>Parameters:</p> Name Type Description Default <code>text</code> <code>str</code> <p>The string to hash.</p> required <p>Returns:</p> Type Description <code>str</code> <p>A 64-character lowercase hexadecimal SHA-256 digest.</p> Source code in <code>pre_commit_snippet/cache.py</code> <pre><code>def compute_hash(text: str) -&gt; str:\n    \"\"\"\n    Return a deterministic SHA-256 hex digest for a Unicode string.\n\n    Args:\n        text: The string to hash.\n\n    Returns:\n        A 64-character lowercase hexadecimal SHA-256 digest.\n    \"\"\"\n    return hashlib.sha256(text.encode(\"utf-8\")).hexdigest()\n</code></pre>"},{"location":"api/cache/#pre_commit_snippet.cache.load_cache","title":"<code>load_cache(cache_file)</code>","text":"<p>Load the JSON cache from disk.</p> <p>Parameters:</p> Name Type Description Default <code>cache_file</code> <code>Path</code> <p>Path to the cache file.</p> required <p>Returns:</p> Type Description <code>dict[str, str]</code> <p>A dictionary mapping cache keys to hash values.</p> <code>dict[str, str]</code> <p>Returns an empty dict if the file does not exist or is corrupt.</p> Source code in <code>pre_commit_snippet/cache.py</code> <pre><code>def load_cache(cache_file: Path) -&gt; dict[str, str]:\n    \"\"\"\n    Load the JSON cache from disk.\n\n    Args:\n        cache_file: Path to the cache file.\n\n    Returns:\n        A dictionary mapping cache keys to hash values.\n        Returns an empty dict if the file does not exist or is corrupt.\n    \"\"\"\n    if not cache_file.is_file():\n        return {}\n    try:\n        data = json.loads(cache_file.read_text(encoding=\"utf-8\"))\n        if isinstance(data, dict):\n            return dict(data)\n        return {}\n    except Exception:\n        return {}\n</code></pre>"},{"location":"api/cache/#pre_commit_snippet.cache.save_cache","title":"<code>save_cache(cache_file, cache)</code>","text":"<p>Write the cache to disk atomically.</p> <p>Uses a temporary file and rename to avoid corruption on crash.</p> <p>Parameters:</p> Name Type Description Default <code>cache_file</code> <code>Path</code> <p>Path to the cache file.</p> required <code>cache</code> <code>dict[str, str]</code> <p>A dictionary mapping cache keys to hash values.</p> required Source code in <code>pre_commit_snippet/cache.py</code> <pre><code>def save_cache(cache_file: Path, cache: dict[str, str]) -&gt; None:\n    \"\"\"\n    Write the cache to disk atomically.\n\n    Uses a temporary file and rename to avoid corruption on crash.\n\n    Args:\n        cache_file: Path to the cache file.\n        cache: A dictionary mapping cache keys to hash values.\n    \"\"\"\n    tmp = cache_file.with_suffix(\".tmp\")\n    tmp.write_text(json.dumps(cache, indent=2, sort_keys=True), encoding=\"utf-8\")\n    tmp.replace(cache_file)\n</code></pre>"},{"location":"api/cli/","title":"cli","text":"<p>Command-line interface for pre-commit-snippet.</p>"},{"location":"api/cli/#pre_commit_snippet.cli","title":"<code>cli</code>","text":"<p>Command-line interface for pre-commit-snippet.</p> <p>This module provides the main entry point and argument parsing for the pre-commit hook. It orchestrates the overall flow: loading configuration, cloning the snippet repository, processing target files, and staging changes.</p>"},{"location":"api/cli/#pre_commit_snippet.cli.main","title":"<code>main()</code>","text":"<p>Main entry point for the pre-commit hook.</p> <p>Returns:</p> Type Description <code>int</code> <p>Exit code (0 for success, non-zero for failure).</p> Source code in <code>pre_commit_snippet/cli.py</code> <pre><code>def main() -&gt; int:\n    \"\"\"\n    Main entry point for the pre-commit hook.\n\n    Returns:\n        Exit code (0 for success, non-zero for failure).\n    \"\"\"\n    parser = argparse.ArgumentParser(description=\"Sync markdown snippets from a central repository.\")\n    parser.add_argument(\n        \"--dry-run\",\n        action=\"store_true\",\n        help=\"Preview changes without modifying files.\",\n    )\n    parser.add_argument(\n        \"--verbose\",\n        \"-v\",\n        action=\"store_true\",\n        help=\"Print detailed information about processing.\",\n    )\n    parser.add_argument(\n        \"--debug\",\n        action=\"store_true\",\n        help=\"Print debug information (implies --verbose).\",\n    )\n    args = parser.parse_args()\n\n    # Setup logging based on flags\n    setup_logging(verbose=args.verbose, debug=args.debug)\n\n    logger.debug(\"Starting pre-commit-snippet\")\n    logger.debug(\"Arguments: dry_run=%s, verbose=%s, debug=%s\", args.dry_run, args.verbose, args.debug)\n\n    # Get repo root\n    try:\n        repo_root = get_repo_root()\n        logger.debug(\"Repository root: %s\", repo_root)\n    except subprocess.CalledProcessError:\n        logger.error(\"Not in a git repository\")\n        return 1\n\n    # Load configuration\n    config_path = repo_root / \"pre-commit-snippet-config.yaml\"\n    try:\n        config = load_config(config_path)\n        logger.debug(\"Loaded config from %s\", config_path)\n    except FileNotFoundError as e:\n        logger.error(\"%s\", e)\n        return 1\n    except ValueError as e:\n        logger.error(\"%s\", e)\n        return 1\n\n    if not config.target_files:\n        logger.warning(\"No target_files specified in config; nothing to do.\")\n        return 0\n\n    source = config.primary_source\n    if source is None:\n        logger.error(\"No snippet source configured\")\n        return 1\n\n    logger.info(\"Snippet repo: %s\", source.repo)\n    if source.branch:\n        logger.info(\"Branch/tag: %s\", source.branch)\n    logger.debug(\"Snippet subdir: %s\", source.subdir)\n    logger.debug(\"Snippet ext: %s\", source.ext)\n    logger.info(\"Target files: %s\", \", \".join(config.target_files))\n\n    # Clone the snippet repo\n    tmp_dir = repo_root / \".git\" / \"hooks\" / \"tmp-snippets\"\n    try:\n        snippet_root = clone_snippet_repo(source, tmp_dir)\n    except subprocess.CalledProcessError:\n        logger.error(\"Failed to clone snippet repository: %s\", source.repo)\n        cleanup_temp_dir(tmp_dir)\n        return 1\n    except FileNotFoundError as e:\n        logger.error(\"%s\", e)\n        return 1\n\n    # Load cache\n    cache_file = repo_root / \".snippet-hashes.json\"\n    cache = load_cache(cache_file)\n    logger.debug(\"Loaded cache with %d entries\", len(cache))\n\n    # Process each target file\n    any_modified = False\n    for rel in config.target_files:\n        md_path = repo_root / rel\n        if not md_path.is_file():\n            logger.warning(\"Target file not found: %s\", rel)\n            continue\n        logger.info(\"Processing %s\", rel)\n        if replace_blocks(\n            md_path,\n            repo_root,\n            snippet_root,\n            source.ext,\n            cache,\n            dry_run=args.dry_run,\n        ):\n            any_modified = True\n\n    # Persist the cache\n    if not args.dry_run:\n        save_cache(cache_file, cache)\n        logger.debug(\"Saved cache with %d entries\", len(cache))\n\n    # Cleanup temporary clone &amp; stage modified files\n    cleanup_temp_dir(tmp_dir)\n\n    if any_modified and not args.dry_run:\n        stage_files(config.target_files, repo_root)\n        logger.info(\"Staged modified files\")\n\n    if args.dry_run and any_modified:\n        logger.warning(\"Dry run complete. No files were modified.\")\n    elif not any_modified:\n        logger.info(\"All snippets are up to date\")\n\n    logger.debug(\"Finished pre-commit-snippet\")\n    return 0\n</code></pre>"},{"location":"api/config/","title":"config","text":"<p>Configuration loading and validation.</p>"},{"location":"api/config/#pre_commit_snippet.config","title":"<code>config</code>","text":"<p>Configuration loading and validation.</p> <p>This module handles loading the pre-commit-snippet-config.yaml file and validating its contents. It defines dataclasses for structured configuration and provides a minimal YAML parser with no external dependencies.</p>"},{"location":"api/config/#pre_commit_snippet.config.SnippetSource","title":"<code>SnippetSource</code>  <code>dataclass</code>","text":"<p>Configuration for a single snippet source repository.</p> <p>Attributes:</p> Name Type Description <code>repo</code> <code>str</code> <p>URL or path to the snippet repository.</p> <code>branch</code> <code>str</code> <p>Branch or tag to clone. Empty string for default branch.</p> <code>subdir</code> <code>str</code> <p>Subdirectory within the repo containing snippets.</p> <code>ext</code> <code>str</code> <p>File extension for snippet files (e.g., \".md\").</p> Source code in <code>pre_commit_snippet/config.py</code> <pre><code>@dataclass\nclass SnippetSource:\n    \"\"\"\n    Configuration for a single snippet source repository.\n\n    Attributes:\n        repo: URL or path to the snippet repository.\n        branch: Branch or tag to clone. Empty string for default branch.\n        subdir: Subdirectory within the repo containing snippets.\n        ext: File extension for snippet files (e.g., \".md\").\n    \"\"\"\n\n    repo: str\n    branch: str = \"\"\n    subdir: str = \".\"\n    ext: str = \".md\"\n</code></pre>"},{"location":"api/config/#pre_commit_snippet.config.Config","title":"<code>Config</code>  <code>dataclass</code>","text":"<p>Main configuration for the snippet hook.</p> <p>Attributes:</p> Name Type Description <code>sources</code> <code>list[SnippetSource]</code> <p>List of snippet source repositories.</p> <code>target_files</code> <code>list[str]</code> <p>List of file paths (relative to repo root) to process.</p> Source code in <code>pre_commit_snippet/config.py</code> <pre><code>@dataclass\nclass Config:\n    \"\"\"\n    Main configuration for the snippet hook.\n\n    Attributes:\n        sources: List of snippet source repositories.\n        target_files: List of file paths (relative to repo root) to process.\n    \"\"\"\n\n    sources: list[SnippetSource] = field(default_factory=list)\n    target_files: list[str] = field(default_factory=list)\n\n    @property\n    def primary_source(self) -&gt; SnippetSource | None:\n        \"\"\"\n        Get the primary (first) snippet source.\n\n        Returns:\n            The first SnippetSource, or None if no sources are configured.\n        \"\"\"\n        return self.sources[0] if self.sources else None\n</code></pre>"},{"location":"api/config/#pre_commit_snippet.config.Config.primary_source","title":"<code>primary_source</code>  <code>property</code>","text":"<p>Get the primary (first) snippet source.</p> <p>Returns:</p> Type Description <code>SnippetSource | None</code> <p>The first SnippetSource, or None if no sources are configured.</p>"},{"location":"api/config/#pre_commit_snippet.config.load_yaml","title":"<code>load_yaml(path)</code>","text":"<p>Parse the very simple flat YAML used for the config.</p> <p>Supports only flat key-value pairs and lists (using \"- item\" syntax). Does not handle nested structures, quoted strings with colons, or multiline values.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>Path</code> <p>Path to the YAML configuration file.</p> required <p>Returns:</p> Type Description <code>dict[str, str | list[str]]</code> <p>A dictionary mapping keys to either string values or lists of strings.</p> Source code in <code>pre_commit_snippet/config.py</code> <pre><code>def load_yaml(path: Path) -&gt; dict[str, str | list[str]]:\n    \"\"\"\n    Parse the very simple flat YAML used for the config.\n\n    Supports only flat key-value pairs and lists (using \"- item\" syntax).\n    Does not handle nested structures, quoted strings with colons, or multiline values.\n\n    Args:\n        path: Path to the YAML configuration file.\n\n    Returns:\n        A dictionary mapping keys to either string values or lists of strings.\n    \"\"\"\n    data: dict[str, str | list[str]] = {}\n    cur_key: str | None = None\n    with path.open() as f:\n        for raw in f:\n            line = raw.strip()\n            if not line or line.startswith(\"#\"):\n                continue\n            if \":\" in line and not line.startswith(\"-\"):\n                key, val = line.split(\":\", 1)\n                key = key.strip()\n                val = val.strip()\n                if val == \"\":\n                    cur_key = key\n                    data[cur_key] = []\n                else:\n                    data[key] = val\n                    cur_key = None\n            elif line.startswith(\"-\") and cur_key is not None:\n                cur_list = data[cur_key]\n                if isinstance(cur_list, list):\n                    cur_list.append(line.lstrip(\"-\").strip())\n    return data\n</code></pre>"},{"location":"api/config/#pre_commit_snippet.config.load_config","title":"<code>load_config(config_path)</code>","text":"<p>Load and validate configuration from a YAML file.</p> <p>Parameters:</p> Name Type Description Default <code>config_path</code> <code>Path</code> <p>Path to the configuration file.</p> required <p>Returns:</p> Type Description <code>Config</code> <p>A validated Config object.</p> <p>Raises:</p> Type Description <code>FileNotFoundError</code> <p>If the config file doesn't exist.</p> <code>ValueError</code> <p>If required config keys are missing.</p> Source code in <code>pre_commit_snippet/config.py</code> <pre><code>def load_config(config_path: Path) -&gt; Config:\n    \"\"\"\n    Load and validate configuration from a YAML file.\n\n    Args:\n        config_path: Path to the configuration file.\n\n    Returns:\n        A validated Config object.\n\n    Raises:\n        FileNotFoundError: If the config file doesn't exist.\n        ValueError: If required config keys are missing.\n    \"\"\"\n    if not config_path.is_file():\n        raise FileNotFoundError(f\"Config file not found at {config_path}\")\n\n    cfg = load_yaml(config_path)\n\n    # Build snippet sources\n    sources: list[SnippetSource] = []\n\n    # Primary source (legacy single-repo format)\n    if \"snippet_repo\" in cfg:\n        repo = cfg[\"snippet_repo\"]\n        if not isinstance(repo, str):\n            raise ValueError(\"snippet_repo must be a string\")\n\n        branch = cfg.get(\"snippet_branch\", \"\")\n        if not isinstance(branch, str):\n            branch = \"\"\n\n        subdir = cfg.get(\"snippet_subdir\", \".\")\n        if not isinstance(subdir, str):\n            subdir = \".\"\n\n        ext = cfg.get(\"snippet_ext\", \".md\")\n        if not isinstance(ext, str):\n            ext = \".md\"\n\n        sources.append(SnippetSource(repo=repo, branch=branch, subdir=subdir, ext=ext))\n\n    if not sources:\n        raise ValueError(\"Missing required config key: snippet_repo\")\n\n    # Target files\n    target_files = cfg.get(\"target_files\", [])\n    if not isinstance(target_files, list):\n        target_files = []\n\n    return Config(sources=sources, target_files=target_files)\n</code></pre>"},{"location":"api/git/","title":"git","text":"<p>Git-related utilities.</p>"},{"location":"api/git/#pre_commit_snippet.git","title":"<code>git</code>","text":"<p>Git-related utilities.</p> <p>This module provides functions for interacting with git repositories, including running git commands, cloning snippet repositories, and staging modified files for commit.</p>"},{"location":"api/git/#pre_commit_snippet.git.run_cmd","title":"<code>run_cmd(args, cwd=None, check=True)</code>","text":"<p>Run a shell command and return its stdout, stripped of whitespace.</p> <p>Parameters:</p> Name Type Description Default <code>args</code> <code>list[str]</code> <p>Command and arguments as a list of strings.</p> required <code>cwd</code> <code>Path | None</code> <p>Working directory for the command. Defaults to current directory.</p> <code>None</code> <code>check</code> <code>bool</code> <p>If True, raise CalledProcessError on non-zero exit. Defaults to True.</p> <code>True</code> <p>Returns:</p> Type Description <code>str</code> <p>The command's stdout with leading/trailing whitespace removed.</p> <p>Raises:</p> Type Description <code>CalledProcessError</code> <p>If check is True and the command fails.</p> Source code in <code>pre_commit_snippet/git.py</code> <pre><code>def run_cmd(args: list[str], cwd: Path | None = None, check: bool = True) -&gt; str:\n    \"\"\"\n    Run a shell command and return its stdout, stripped of whitespace.\n\n    Args:\n        args: Command and arguments as a list of strings.\n        cwd: Working directory for the command. Defaults to current directory.\n        check: If True, raise CalledProcessError on non-zero exit. Defaults to True.\n\n    Returns:\n        The command's stdout with leading/trailing whitespace removed.\n\n    Raises:\n        subprocess.CalledProcessError: If check is True and the command fails.\n    \"\"\"\n    logger.debug(\"Running command: %s\", \" \".join(args))\n    try:\n        result = subprocess.run(\n            args,\n            cwd=cwd,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n            check=check,\n        )\n        if result.stdout.strip():\n            logger.debug(\"stdout: %s\", result.stdout.strip())\n        return result.stdout.strip()\n    except subprocess.CalledProcessError as e:\n        logger.error(\"Command failed: %s\", \" \".join(args))\n        if e.stderr:\n            logger.error(\"  %s\", e.stderr.strip())\n        raise\n</code></pre>"},{"location":"api/git/#pre_commit_snippet.git.get_repo_root","title":"<code>get_repo_root()</code>","text":"<p>Get the root directory of the current git repository.</p> <p>Returns:</p> Type Description <code>Path</code> <p>Path to the repository root.</p> <p>Raises:</p> Type Description <code>CalledProcessError</code> <p>If not in a git repository.</p> Source code in <code>pre_commit_snippet/git.py</code> <pre><code>def get_repo_root() -&gt; Path:\n    \"\"\"\n    Get the root directory of the current git repository.\n\n    Returns:\n        Path to the repository root.\n\n    Raises:\n        subprocess.CalledProcessError: If not in a git repository.\n    \"\"\"\n    return Path(run_cmd([\"git\", \"rev-parse\", \"--show-toplevel\"]))\n</code></pre>"},{"location":"api/git/#pre_commit_snippet.git.clone_snippet_repo","title":"<code>clone_snippet_repo(source, dest)</code>","text":"<p>Clone a snippet repository to a destination directory.</p> <p>Parameters:</p> Name Type Description Default <code>source</code> <code>SnippetSource</code> <p>The snippet source configuration.</p> required <code>dest</code> <code>Path</code> <p>Destination directory for the clone.</p> required <p>Returns:</p> Type Description <code>Path</code> <p>Path to the snippet root (dest / subdir).</p> <p>Raises:</p> Type Description <code>CalledProcessError</code> <p>If the clone fails.</p> <code>FileNotFoundError</code> <p>If the snippet subdirectory doesn't exist.</p> Source code in <code>pre_commit_snippet/git.py</code> <pre><code>def clone_snippet_repo(source: SnippetSource, dest: Path) -&gt; Path:\n    \"\"\"\n    Clone a snippet repository to a destination directory.\n\n    Args:\n        source: The snippet source configuration.\n        dest: Destination directory for the clone.\n\n    Returns:\n        Path to the snippet root (dest / subdir).\n\n    Raises:\n        subprocess.CalledProcessError: If the clone fails.\n        FileNotFoundError: If the snippet subdirectory doesn't exist.\n    \"\"\"\n    if dest.exists():\n        logger.debug(\"Removing existing temp directory: %s\", dest)\n        shutil.rmtree(dest)\n    dest.mkdir(parents=True)\n\n    clone_args = [\"git\", \"clone\", \"--depth\", \"1\"]\n    if source.branch:\n        clone_args.extend([\"--branch\", source.branch])\n    clone_args.extend([source.repo, str(dest)])\n\n    logger.debug(\"Cloning snippet repo: %s\", source.repo)\n    run_cmd(clone_args)\n\n    snippet_root = dest / source.subdir\n    if not snippet_root.is_dir():\n        shutil.rmtree(dest, ignore_errors=True)\n        raise FileNotFoundError(f\"Snippet subdirectory not found: {source.subdir}\")\n\n    logger.debug(\"Snippet root: %s\", snippet_root)\n    return snippet_root\n</code></pre>"},{"location":"api/git/#pre_commit_snippet.git.cleanup_temp_dir","title":"<code>cleanup_temp_dir(tmp_dir)</code>","text":"<p>Remove a temporary directory.</p> <p>Parameters:</p> Name Type Description Default <code>tmp_dir</code> <code>Path</code> <p>The directory to remove.</p> required Source code in <code>pre_commit_snippet/git.py</code> <pre><code>def cleanup_temp_dir(tmp_dir: Path) -&gt; None:\n    \"\"\"\n    Remove a temporary directory.\n\n    Args:\n        tmp_dir: The directory to remove.\n    \"\"\"\n    logger.debug(\"Cleaning up temp directory: %s\", tmp_dir)\n    shutil.rmtree(tmp_dir, ignore_errors=True)\n</code></pre>"},{"location":"api/git/#pre_commit_snippet.git.stage_files","title":"<code>stage_files(files, repo_root)</code>","text":"<p>Stage files for commit.</p> <p>Parameters:</p> Name Type Description Default <code>files</code> <code>list[str]</code> <p>List of file paths relative to repo root.</p> required <code>repo_root</code> <code>Path</code> <p>Root of the git repository.</p> required Source code in <code>pre_commit_snippet/git.py</code> <pre><code>def stage_files(files: list[str], repo_root: Path) -&gt; None:\n    \"\"\"\n    Stage files for commit.\n\n    Args:\n        files: List of file paths relative to repo root.\n        repo_root: Root of the git repository.\n    \"\"\"\n    logger.debug(\"Staging files: %s\", \", \".join(files))\n    run_cmd([\"git\", \"add\"] + files, cwd=repo_root)\n</code></pre>"},{"location":"api/logging/","title":"logging","text":"<p>Logging configuration for pre-commit-snippet.</p>"},{"location":"api/logging/#pre_commit_snippet.logging","title":"<code>logging</code>","text":"<p>Logging configuration for pre-commit-snippet.</p> <p>This module provides a centralized logger and configuration function for the package. It supports three verbosity levels: WARNING (default), INFO (--verbose), and DEBUG (--debug).</p>"},{"location":"api/logging/#pre_commit_snippet.logging.setup_logging","title":"<code>setup_logging(verbose=False, debug=False)</code>","text":"<p>Configure logging for the application.</p> <p>Parameters:</p> Name Type Description Default <code>verbose</code> <code>bool</code> <p>If True, set level to INFO.</p> <code>False</code> <code>debug</code> <code>bool</code> <p>If True, set level to DEBUG (overrides verbose).</p> <code>False</code> Source code in <code>pre_commit_snippet/logging.py</code> <pre><code>def setup_logging(verbose: bool = False, debug: bool = False) -&gt; None:\n    \"\"\"\n    Configure logging for the application.\n\n    Args:\n        verbose: If True, set level to INFO.\n        debug: If True, set level to DEBUG (overrides verbose).\n    \"\"\"\n    if debug:\n        level = logging.DEBUG\n        fmt = \"%(asctime)s [%(levelname)s] %(name)s: %(message)s\"\n    elif verbose:\n        level = logging.INFO\n        fmt = \"%(message)s\"\n    else:\n        level = logging.WARNING\n        fmt = \"%(message)s\"\n\n    handler = logging.StreamHandler(sys.stderr)\n    handler.setFormatter(logging.Formatter(fmt))\n\n    logger.setLevel(level)\n    logger.handlers.clear()\n    logger.addHandler(handler)\n    logger.propagate = False\n</code></pre>"},{"location":"api/snippet/","title":"snippet","text":"<p>Core snippet replacement logic.</p>"},{"location":"api/snippet/#pre_commit_snippet.snippet","title":"<code>snippet</code>","text":"<p>Core snippet replacement logic.</p> <p>This module contains the main logic for finding and replacing snippet blocks in markdown files. It handles parsing SNIPPET-START/SNIPPET-END markers, comparing hashes to detect changes, and updating file contents.</p>"},{"location":"api/snippet/#pre_commit_snippet.snippet.replace_blocks","title":"<code>replace_blocks(md_path, repo_root, snippet_root, snippet_ext, cache, dry_run=False)</code>","text":"<p>Process a markdown file and replace snippet blocks with central repo content.</p> <p>Walks the file, finds each SNIPPET-START/SNIPPET-END pair, and rewrites the block only when the cached hash differs from the authoritative snippet hash.</p> <p>Parameters:</p> Name Type Description Default <code>md_path</code> <code>Path</code> <p>Path to the markdown file to process.</p> required <code>repo_root</code> <code>Path</code> <p>Root of the git repository.</p> required <code>snippet_root</code> <code>Path</code> <p>Root directory of the cloned snippet repo.</p> required <code>snippet_ext</code> <code>str</code> <p>File extension for snippet files.</p> required <code>cache</code> <code>dict[str, str]</code> <p>Mutable cache dictionary to update.</p> required <code>dry_run</code> <code>bool</code> <p>If True, don't write changes to disk.</p> <code>False</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if the file was (or would be) modified, False otherwise.</p> Source code in <code>pre_commit_snippet/snippet.py</code> <pre><code>def replace_blocks(\n    md_path: Path,\n    repo_root: Path,\n    snippet_root: Path,\n    snippet_ext: str,\n    cache: dict[str, str],\n    dry_run: bool = False,\n) -&gt; bool:\n    \"\"\"\n    Process a markdown file and replace snippet blocks with central repo content.\n\n    Walks the file, finds each SNIPPET-START/SNIPPET-END pair, and rewrites the\n    block only when the cached hash differs from the authoritative snippet hash.\n\n    Args:\n        md_path: Path to the markdown file to process.\n        repo_root: Root of the git repository.\n        snippet_root: Root directory of the cloned snippet repo.\n        snippet_ext: File extension for snippet files.\n        cache: Mutable cache dictionary to update.\n        dry_run: If True, don't write changes to disk.\n\n    Returns:\n        True if the file was (or would be) modified, False otherwise.\n    \"\"\"\n    logger.debug(\"Processing file: %s\", md_path)\n    original = md_path.read_text(encoding=\"utf-8\")\n    lines = original.splitlines(keepends=True)\n\n    out: list[str] = []\n    i = 0\n    changed = False\n\n    while i &lt; len(lines):\n        start_match = START_RE.search(lines[i])\n        if start_match:\n            snippet_name = start_match.group(\"name\").strip()\n            logger.debug(\"Found snippet marker: %s at line %d\", snippet_name, i + 1)\n\n            # locate the matching END marker\n            j = i + 1\n            while j &lt; len(lines) and not END_RE.search(lines[j]):\n                j += 1\n            if j &gt;= len(lines):\n                logger.warning(\"Missing SNIPPET-END after line %d in %s\", i + 1, md_path)\n                out.append(lines[i])\n                i += 1\n                continue\n\n            # ----- Existing block hash (cached or compute) -----\n            existing_block = \"\".join(lines[i + 1 : j]).rstrip(\"\\n\")\n            cache_key = f\"{md_path.relative_to(repo_root)}::{snippet_name}\"\n            cached_hash = cache.get(cache_key)\n\n            if cached_hash is None:\n                existing_hash = compute_hash(existing_block)\n                cache[cache_key] = existing_hash\n                cached_hash = existing_hash\n                logger.debug(\"Computed hash for existing block: %s\", cached_hash[:12])\n\n            # ----- Authoritative snippet hash -----\n            snippet_path = snippet_root / f\"{snippet_name}{snippet_ext}\"\n            if not snippet_path.is_file():\n                logger.warning(\"Snippet not found: %s%s\", snippet_name, snippet_ext)\n                out.extend(lines[i : j + 1])\n                i = j + 1\n                continue\n\n            snippet_body = snippet_path.read_text(encoding=\"utf-8\").rstrip(\"\\n\")\n            snippet_hash = compute_hash(snippet_body)\n            logger.debug(\"Snippet hash: %s\", snippet_hash[:12])\n\n            # ----- Decide whether to rewrite -----\n            if cached_hash != snippet_hash:\n                logger.info(\"Updating snippet '%s' in %s\", snippet_name, md_path.name)\n                logger.debug(\n                    \"Hash mismatch: cached=%s, snippet=%s\",\n                    cached_hash[:12],\n                    snippet_hash[:12],\n                )\n                out.append(f\"&lt;!-- SNIPPET-START: {snippet_name} --&gt;\\n\")\n                out.append(snippet_body + \"\\n\")\n                out.append(\"&lt;!-- SNIPPET-END --&gt;\\n\")\n                changed = True\n                cache[cache_key] = snippet_hash\n            else:\n                logger.debug(\"Snippet '%s' is up to date\", snippet_name)\n                out.extend(lines[i : j + 1])\n\n            i = j + 1\n        else:\n            out.append(lines[i])\n            i += 1\n\n    if changed and not dry_run:\n        logger.debug(\"Writing updated file: %s\", md_path)\n        md_path.write_text(\"\".join(out), encoding=\"utf-8\")\n    elif changed and dry_run:\n        logger.info(\"Would update: %s\", md_path.name)\n\n    return changed\n</code></pre>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>Create a <code>pre-commit-snippet-config.yaml</code> file in your repository root.</p>"},{"location":"getting-started/configuration/#example-configuration","title":"Example Configuration","text":"<pre><code># URL of the repository containing your snippets (required)\nsnippet_repo: https://github.com/your-org/snippets.git\n\n# Branch or tag to use (optional, default: default branch)\nsnippet_branch: main\n\n# Subdirectory within the snippet repo where snippets are stored (optional)\nsnippet_subdir: snippets\n\n# File extension for snippet files (optional, default: .md)\nsnippet_ext: .md\n\n# List of files to process (required)\ntarget_files:\n  - README.md\n  - docs/CONTRIBUTING.md\n  - docs/SECURITY.md\n</code></pre>"},{"location":"getting-started/configuration/#configuration-options","title":"Configuration Options","text":""},{"location":"getting-started/configuration/#snippet_repo-required","title":"<code>snippet_repo</code> (required)","text":"<p>URL or path to the repository containing your snippet files.</p> <pre><code># HTTPS URL\nsnippet_repo: https://github.com/your-org/snippets.git\n\n# SSH URL\nsnippet_repo: git@github.com:your-org/snippets.git\n\n# Local path\nsnippet_repo: /path/to/local/snippets\n</code></pre>"},{"location":"getting-started/configuration/#snippet_branch-optional","title":"<code>snippet_branch</code> (optional)","text":"<p>Branch or tag to clone from the snippet repository.</p> <pre><code>snippet_branch: main\nsnippet_branch: v1.0.0\nsnippet_branch: release/2.0\n</code></pre> <p>If not specified, the repository's default branch is used.</p>"},{"location":"getting-started/configuration/#snippet_subdir-optional","title":"<code>snippet_subdir</code> (optional)","text":"<p>Subdirectory within the snippet repository where snippet files are located.</p> <pre><code>snippet_subdir: snippets\nsnippet_subdir: docs/shared\n</code></pre> <p>Default: <code>.</code> (repository root)</p>"},{"location":"getting-started/configuration/#snippet_ext-optional","title":"<code>snippet_ext</code> (optional)","text":"<p>File extension for snippet files.</p> <pre><code>snippet_ext: .md\nsnippet_ext: .txt\nsnippet_ext: .html\n</code></pre> <p>Default: <code>.md</code></p>"},{"location":"getting-started/configuration/#target_files-required","title":"<code>target_files</code> (required)","text":"<p>List of files in your repository to process for snippet markers.</p> <pre><code>target_files:\n  - README.md\n  - docs/index.md\n  - CONTRIBUTING.md\n</code></pre> <p>Paths are relative to the repository root.</p>"},{"location":"getting-started/configuration/#cache-file","title":"Cache File","text":"<p>The hook creates a <code>.snippet-hashes.json</code> file to track which snippets have been applied. </p> <p>Tip</p> <p>Commit this file to your repository to avoid unnecessary rewrites on other machines.</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Current version: 0.1.0</p>"},{"location":"getting-started/installation/#using-pre-commit-framework","title":"Using pre-commit framework","text":"<p>The recommended way to use pre-commit-snippet is with the pre-commit framework.</p> <p>Add this to your <code>.pre-commit-config.yaml</code>:</p> <pre><code>repos:\n  - repo: https://github.com/YOUR_USERNAME/pre-commit-snippet\n    rev: v0.1.0  # Use the latest tag\n    hooks:\n      - id: snippet-sync\n</code></pre> <p>Then install the hooks:</p> <pre><code>pre-commit install\n</code></pre>"},{"location":"getting-started/installation/#using-pip","title":"Using pip","text":"<p>Install directly with pip:</p> <pre><code>pip install pre-commit-snippet\n</code></pre> <p>Then run manually or add to your workflow:</p> <pre><code>pre-commit-snippet\n</code></pre>"},{"location":"getting-started/installation/#manual-installation","title":"Manual installation","text":"<p>Clone the repository and run directly:</p> <pre><code>git clone https://github.com/YOUR_USERNAME/pre-commit-snippet.git\ncd pre-commit-snippet\npython main.py\n</code></pre>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.9 or higher</li> <li>Git (for cloning snippet repositories)</li> </ul>"},{"location":"getting-started/usage/","title":"Usage","text":""},{"location":"getting-started/usage/#snippet-markers","title":"Snippet Markers","text":"<p>Add markers to your markdown files to indicate where snippets should be inserted:</p> <pre><code># My Project\n\n&lt;!-- SNIPPET-START: license-notice --&gt;\nThis content will be replaced with the contents of `license-notice.md` from your snippet repo.\n&lt;!-- SNIPPET-END --&gt;\n\n## Other content...\n</code></pre> <p>The snippet name (<code>license-notice</code> in this example) corresponds to a file in your snippet repository (<code>license-notice.md</code>).</p>"},{"location":"getting-started/usage/#command-line-options","title":"Command Line Options","text":"<pre><code>pre-commit-snippet [OPTIONS]\n</code></pre>"},{"location":"getting-started/usage/#-dry-run","title":"<code>--dry-run</code>","text":"<p>Preview changes without modifying files.</p> <pre><code>pre-commit-snippet --dry-run\n</code></pre>"},{"location":"getting-started/usage/#-verbose-v","title":"<code>--verbose</code>, <code>-v</code>","text":"<p>Print info-level logs showing files being processed and updates.</p> <pre><code>pre-commit-snippet --verbose\n</code></pre>"},{"location":"getting-started/usage/#-debug","title":"<code>--debug</code>","text":"<p>Print debug-level logs with timestamps, commands, and hash values.</p> <pre><code>pre-commit-snippet --debug\n</code></pre>"},{"location":"getting-started/usage/#examples","title":"Examples","text":""},{"location":"getting-started/usage/#normal-run","title":"Normal Run","text":"<pre><code>$ pre-commit-snippet\n</code></pre> <p>No output if all snippets are up to date.</p>"},{"location":"getting-started/usage/#preview-changes","title":"Preview Changes","text":"<pre><code>$ pre-commit-snippet --dry-run\nWould update: README.md\nDry run complete. No files were modified.\n</code></pre>"},{"location":"getting-started/usage/#verbose-output","title":"Verbose Output","text":"<pre><code>$ pre-commit-snippet --verbose\nSnippet repo: https://github.com/your-org/snippets.git\nTarget files: README.md, CONTRIBUTING.md\nProcessing README.md\nUpdating snippet 'license-notice' in README.md\nProcessing CONTRIBUTING.md\nAll snippets are up to date\nStaged modified files\n</code></pre>"},{"location":"getting-started/usage/#debug-output","title":"Debug Output","text":"<pre><code>$ pre-commit-snippet --debug\n2024-01-15 10:30:00 [DEBUG] pre_commit_snippet: Starting pre-commit-snippet\n2024-01-15 10:30:00 [DEBUG] pre_commit_snippet: Running command: git rev-parse --show-toplevel\n2024-01-15 10:30:00 [DEBUG] pre_commit_snippet: Repository root: /home/user/project\n...\n</code></pre>"},{"location":"getting-started/usage/#how-it-works","title":"How It Works","text":"<ol> <li>Clone: Shallow clones the snippet repository to a temporary directory</li> <li>Parse: Finds all <code>SNIPPET-START</code> / <code>SNIPPET-END</code> marker pairs in target files</li> <li>Compare: Computes SHA-256 hashes to detect changes</li> <li>Replace: Updates blocks only when the snippet has changed</li> <li>Cache: Saves hashes to avoid recomputing on the next run</li> <li>Stage: Automatically stages modified files for commit</li> <li>Cleanup: Removes the temporary clone</li> </ol>"}]}